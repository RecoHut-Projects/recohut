# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/utils/utils.transforms.ipynb (unless otherwise specified).

__all__ = ['transform_to_gru4rec_format']

# Cell
import pandas as pd
import numpy as np

# Cell
def transform_to_gru4rec_format(dataset,
                                lst_col='sequence',
                                ts_col='timestamp',
                                user_col='user_id',
                                ):
    """
    Convert a list of sequences to GRU4Rec format.
    Based on this StackOverflow answer: https://stackoverflow.com/a/48532692

    :param dataset: the dataset to be transformed
    """
    df = dataset.reset_index()
    unstacked = pd.DataFrame({
        col: np.repeat(df[col].values, df[lst_col].str.len()) for col in df.columns.drop(lst_col)}
    ).assign(**{lst_col: np.concatenate(df[lst_col].values)})[df.columns]
    # ensure that events in the session have increasing timestamps
    unstacked[ts_col] = unstacked[ts_col] + unstacked.groupby(user_col).cumcount()
    unstacked.rename(columns={lst_col: 'item_id'}, inplace=True)
    return unstacked